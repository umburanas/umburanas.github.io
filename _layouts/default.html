<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

{%- include head.html -%}
{%- include custom-head.html -%}

<body>
  <div class="app-container">
    <!-- Mobile toggle button -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Abrir/fechar menu" aria-expanded="false" aria-controls="modernSidebar">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Modern Sidebar Navigation -->
    <aside class="modern-sidebar" id="modernSidebar" role="navigation" aria-label="Navega√ß√£o principal" aria-hidden="true">
      <div class="sidebar-brand">
        <a class="brand-link" href="{{ '/' | relative_url }}">
          <h1 class="brand-title">{{ site.title | escape }}</h1>
        </a>
      </div>

      <nav class="sidebar-menu">
        <ul class="menu-list">
          {%- assign default_paths = site.pages | map: 'path' -%}
          {%- assign page_paths = site.header_pages | default: default_paths -%}
          {%- for path in page_paths -%}
            {%- assign my_page = site.pages | where: 'path', path | first -%}
            {%- if my_page.title -%}
              {%- assign nav_title = site.navigation[path] | default: my_page.title -%}
              <li class="menu-item">
                <a class="menu-link {% if page.url == my_page.url %}active{% endif %}" href="{{ my_page.url | relative_url }}">
                  <span class="menu-text">{{ nav_title | escape }}</span>
                </a>
              </li>
            {%- endif -%}
          {%- endfor -%}
        </ul>
      </nav>

      <div class="sidebar-footer">
        <div class="language-selector">
          <div class="language-title">Idiomas</div>
          <div class="language-flags">
            {%- for lang in site.languages -%}
              {%- assign is_active = lang == site.default_lang -%}
              <a class="flag-btn {% if is_active %}active{% endif %}" href="{{ page.url | relative_url }}" aria-label="Idioma {{ lang | upcase }}">
                {%- case lang -%}
                  {%- when 'pt' -%}<span class="flag-icon flag-icon-br"></span>
                  {%- when 'en' -%}<span class="flag-icon flag-icon-gb"></span>
                  {%- when 'es' -%}<span class="flag-icon flag-icon-es"></span>
                  {%- when 'de' -%}<span class="flag-icon">üá©üá™</span>
                  {%- else -%}<span class="flag-icon">üåê</span>
                {%- endcase -%}
              </a>
            {%- endfor -%}
          </div>
        </div>
      </div>
    </aside>

    <div class="main-area">
      {% if page.hero_title or page.hero_subtitle %}
      <section class="hero">
        <div class="hero-inner">
          {% if page.hero_title %}<h1 class="hero-title">{{ page.hero_title }}</h1>{% endif %}
          {% if page.hero_subtitle %}<p class="hero-subtitle">{{ page.hero_subtitle }}</p>{% endif %}
          <div class="hero-actions">
            <a class="btn btn-primary" href="{{ '/evolucao' | relative_url }}">Ver evolu√ß√£o</a>
            <a class="btn btn-secondary" href="{{ '/consorcios' | relative_url }}">Ver cons√≥rcios</a>
          </div>
        </div>
      </section>
      {% endif %}
      <main class="content-wrapper" aria-label="Content">
        <div class="content-inner">
          {{ content }}
        </div>
      </main>
      <footer class="content-footer">
        {%- include footer.html -%}
      </footer>
    </div>
  </div>

  <script>
      (function() {
        var sidebar = document.getElementById('modernSidebar');
        var toggle = document.getElementById('mobileMenuToggle');
        var overlay = document.getElementById('mobileOverlay');
        var firstLink = null;
  
        function setAria(isOpen) {
          if (toggle) toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
          if (sidebar) sidebar.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
        }
  
        function open() {
          sidebar.classList.add('mobile-open');
          document.body.classList.add('sidebar-mobile-open');
          overlay.classList.add('active');
          setAria(true);
          // focus first link for accessibility
          firstLink = sidebar.querySelector('.menu-link');
          if (firstLink) firstLink.focus({ preventScroll: true });
        }
        function close() {
          sidebar.classList.remove('mobile-open');
          document.body.classList.remove('sidebar-mobile-open');
          overlay.classList.remove('active');
          setAria(false);
          if (toggle) toggle.focus({ preventScroll: true });
        }
        if (toggle) {
          toggle.addEventListener('click', function() {
            if (sidebar.classList.contains('mobile-open')) { close(); } else { open(); }
          });
          // close on Escape
          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && sidebar.classList.contains('mobile-open')) {
              close();
            }
          });
        }
        if (overlay) {
          overlay.addEventListener('click', close);
        }

        // Lazy-load all images by default
        try {
          var imgs = document.querySelectorAll('img');
          imgs.forEach(function(img) {
            if (!img.hasAttribute('loading')) {
              img.setAttribute('loading', 'lazy');
            }
          });
        } catch (e) {}
      })();
    </script>
</body>

</html>