<div class="language-selector">
    <div class="language-dropdown">
        <button class="language-btn" id="languageBtn">
            <span class="flag-icon flag-icon-br" id="currentFlag"></span>
            <span class="language-text" id="currentLang">PT</span>
            <span class="dropdown-arrow">▼</span>
        </button>
        <div class="language-menu" id="languageMenu">
            <a href="#" class="language-option" data-lang="pt" data-flag="br">
                <span class="flag-icon flag-icon-br"></span>
                <span>Português</span>
            </a>
            <a href="#" class="language-option" data-lang="es" data-flag="es">
                <span class="flag-icon flag-icon-es"></span>
                <span>Español</span>
            </a>
            <a href="#" class="language-option" data-lang="en" data-flag="gb">
                <span class="flag-icon flag-icon-gb"></span>
                <span>English</span>
            </a>
            <a href="#" class="language-option" data-lang="de" data-flag="de">
                <span class="flag-icon flag-icon-de"></span>
                <span>Deutsch</span>
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const languageBtn = document.getElementById('languageBtn');
        const languageMenu = document.getElementById('languageMenu');
        const currentFlag = document.getElementById('currentFlag');
        const currentLang = document.getElementById('currentLang');

        // Get current language from localStorage or default to 'pt'
        let currentLanguage = localStorage.getItem('selectedLanguage') || 'pt';

        // Set initial flag and language
        updateCurrentLanguage(currentLanguage);

        // Toggle dropdown
        languageBtn.addEventListener('click', function (e) {
            e.preventDefault();
            languageMenu.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.language-dropdown')) {
                languageMenu.classList.remove('show');
            }
        });

        // Handle language selection
        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', function (e) {
                e.preventDefault();
                const lang = this.dataset.lang;
                const flag = this.dataset.flag;

                // Update current language
                currentLanguage = lang;
                localStorage.setItem('selectedLanguage', lang);
                updateCurrentLanguage(lang);

                // Close dropdown
                languageMenu.classList.remove('show');

                // Translate page
                translatePage(lang);
            });
        });

        function updateCurrentLanguage(lang) {
            const flagMap = {
                'pt': 'br',
                'es': 'es',
                'en': 'gb',
                'de': 'de'
            };

            const langMap = {
                'pt': 'PT',
                'es': 'ES',
                'en': 'EN',
                'de': 'DE'
            };

            currentFlag.className = `flag-icon flag-icon-${flagMap[lang]}`;
            currentLang.textContent = langMap[lang];
        }

        function translatePage(lang) {
            // This is a simplified translation system
            // In a real implementation, you would load different content files
            // or use a more sophisticated translation system

            const translations = {
                pt: {
                    'História': 'História',
                    'Evolução': 'Evolução',
                    'Consórcios': 'Consórcios',
                    'Recursos': 'Recursos',
                    'Sobre': 'Sobre',
                    'Contato': 'Contato'
                },
                es: {
                    'História': 'Historia',
                    'Evolução': 'Evolución',
                    'Consórcios': 'Consorcios',
                    'Recursos': 'Recursos',
                    'Sobre': 'Acerca de',
                    'Contato': 'Contacto'
                },
                en: {
                    'História': 'History',
                    'Evolução': 'Evolution',
                    'Consórcios': 'Consortiums',
                    'Recursos': 'Resources',
                    'Sobre': 'About',
                    'Contato': 'Contact'
                },
                de: {
                    'História': 'Geschichte',
                    'Evolução': 'Entwicklung',
                    'Consórcios': 'Konsortien',
                    'Recursos': 'Ressourcen',
                    'Sobre': 'Über uns',
                    'Contato': 'Kontakt'
                }
            };

            // Update navigation menu
            document.querySelectorAll('.site-nav .page-link').forEach(link => {
                const originalText = link.textContent.trim();
                if (translations[lang] && translations[lang][originalText]) {
                    link.textContent = translations[lang][originalText];
                }
            });
        }

        // Apply saved language on page load
        if (currentLanguage !== 'pt') {
            translatePage(currentLanguage);
        }
    });
</script>